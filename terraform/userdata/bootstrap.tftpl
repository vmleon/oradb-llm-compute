#!/bin/bash

touch /home/opc/bootstrap.lock

# Update and upgrade repo
dnf update -y
dnf upgrade -y

# Install Ollama
curl -fsSL https://ollama.com/install.sh | sh

# Configure Ollama to listen on all interfaces with explicit port
mkdir -p /etc/systemd/system/ollama.service.d
cat > /etc/systemd/system/ollama.service.d/override.conf << EOF
[Service]
Environment="OLLAMA_HOST=0.0.0.0:11434"
EOF

# Reload systemd and start Ollama service
systemctl daemon-reload
systemctl enable ollama
systemctl start ollama

# Pull a default model
ollama pull llama3.2:7b

# Pre-load the model into memory for faster responses
ollama run llama3.2 ""

rm /home/opc/bootstrap.lock